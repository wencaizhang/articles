<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ajax | é˜¿æ–‡çš„ç½‘ç»œç©ºé—´</title><link>/tag/ajax/</link><atom:link href="/tag/ajax/index.xml" rel="self" type="application/rss+xml"/><description>ajax</description><generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>zh-Hans</language><lastBuildDate>Fri, 22 Nov 2019 15:46:45 +0800</lastBuildDate><image><url>/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png</url><title>ajax</title><link>/tag/ajax/</link></image><item><title>Request Methods With Axios</title><link>/post/2019/2019-11-22-request-methods-with-axios/</link><pubDate>Fri, 22 Nov 2019 15:46:45 +0800</pubDate><guid>/post/2019/2019-11-22-request-methods-with-axios/</guid><description>&lt;p>Axios æ˜¯ä¸€ä¸ªåŸºäºŽ promise çš„ HTTP åº“ï¼Œå¯ä»¥ç”¨åœ¨æµè§ˆå™¨å’Œ node.js ä¸­ã€‚&lt;/p>
&lt;p>Axios æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>æ”¯æŒæµè§ˆå™¨å’Œnode.js&lt;/li>
&lt;li>æ”¯æŒpromise&lt;/li>
&lt;li>èƒ½æ‹¦æˆªè¯·æ±‚å’Œå“åº”&lt;/li>
&lt;li>èƒ½è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®&lt;/li>
&lt;li>èƒ½å–æ¶ˆè¯·æ±‚&lt;/li>
&lt;li>è‡ªåŠ¨è½¬æ¢JSONæ•°æ®&lt;/li>
&lt;li>æµè§ˆå™¨ç«¯æ”¯æŒé˜²æ­¢CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ )&lt;/li>
&lt;/ul>
&lt;p>axios çš„è¯¦ç»†ä½¿ç”¨éƒ½å¯ä»¥åœ¨
&lt;a href="https://github.com/axios/axios" target="_blank" rel="noopener">https://github.com/axios/axios&lt;/a> ä¸­çœ‹åˆ°ï¼Œæœ¬æ–‡ä¸»è¦å°†åœ¨é¡¹ç›®å®žè·µä¸­å¦‚ä½•è¿›ä¸€æ­¥å°è£… axios ï¼Œä½¿å¾— axios æ›´ç¬¦åˆå®žé™…éœ€æ±‚ã€‚&lt;/p>
&lt;h2 id="å°è£…æ­¥éª¤">å°è£…æ­¥éª¤&lt;/h2>
&lt;h3 id="å…¨å±€é…ç½®">å…¨å±€é…ç½®&lt;/h3>
&lt;p>å…¨å±€é…ç½®æ˜¯æŒ‡é…ç½® &lt;code>baseURL&lt;/code> &lt;code>timeout&lt;/code> ç­‰é€‰é¡¹ã€‚&lt;/p>
&lt;p>å…¨å±€é…ç½®ä¼šå½±å“åˆ°æ¯ä¸ªè¯·æ±‚ï¼Œå¯ä»¥ç›´æŽ¥å¯¹ axios é…ç½®ï¼Œä¹Ÿå¯ä»¥åˆ›å»º axios çš„å®žä¾‹ï¼Œå¯¹å®žä¾‹è¿›è¡Œé…ç½®ã€‚&lt;/p>
&lt;p>axios å’Œ axios å®žä¾‹çš„åŒºåˆ«å°±åœ¨äºŽï¼Œaxios å¯ä»¥åˆ›å»ºå¤šä¸ªå®žä¾‹ï¼Œä¸åŒå®žä¾‹ä¹‹é—´çš„é…ç½®å¯ä»¥ä¸åŒï¼Œå¹¶ä¸”ä¸ä¼šå½±å“åˆ° axios è¿™ä¸ªæºå¤´ã€‚&lt;/p>
&lt;p>ç›´æŽ¥é…ç½® axiosï¼š&lt;/p>
&lt;pre>&lt;code class="language-js">axios.defaults.baseURL = 'https://api.example.com';
axios.defaults.timeout = 2000;
&lt;/code>&lt;/pre>
&lt;p>æˆ–è€…é…ç½® axios å®žä¾‹ï¼š&lt;/p>
&lt;pre>&lt;code class="language-js">import axios from &amp;quot;axios&amp;quot;;
// åˆ›å»º axios å®žä¾‹
const request = axios.create({
baseURL: &amp;quot;https://api.example.com&amp;quot;,
timeout: 2000, // è¯·æ±‚è¶…æ—¶æ—¶é—´
});
&lt;/code>&lt;/pre>
&lt;h3 id="æ‹¦æˆªå™¨">æ‹¦æˆªå™¨&lt;/h3>
&lt;p>axios æ‹¦æˆªå™¨åˆ†ä¸ºã€Œè¯·æ±‚æ‹¦æˆªå™¨ã€å’Œã€Œå“åº”æ‹¦æˆªå™¨ã€ï¼Œå®ƒä»¬ç›¸å½“äºŽæ˜¯é¡¹ç›® http è¯·æ±‚çš„å¤§é—¨ã€‚&lt;/p>
&lt;p>æ¯æ¬¡å‘é€è¯·æ±‚æ—¶è¦ç»è¿‡ã€Œè¯·æ±‚æ‹¦æˆªå™¨ã€è¿™é“é—¨ï¼Œè¯·æ±‚å¾—åˆ°å“åº”æ—¶ä¹Ÿè¦ç»è¿‡ã€Œå“åº”æ‹¦æˆªå™¨ã€è¿™é“é—¨ã€‚&lt;/p>
&lt;p>æœ‰äº†æ‹¦æˆªå™¨ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;ol>
&lt;li>å‘é€è¯·æ±‚æ—¶ï¼Œåˆ¤æ–­ç”¨æˆ·çš„ç™»å½•çŠ¶æ€æˆ–è€…ç”¨æˆ·æƒé™ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„æˆ–è€…è·³è½¬ç™»å½•é¡µé¢æˆ–è€…å¼¹çª—æç¤º&lt;/li>
&lt;li>å‘é€è¯·æ±‚æ—¶ï¼Œæ·»åŠ ç‰¹å®šçš„ headers&lt;/li>
&lt;li>è¯·æ±‚å¾—åˆ°å“åº”æ—¶ï¼Œæ ¹æ®å“åº”çŠ¶æ€ç åšä¸åŒå¤„ç†ï¼š
&lt;ul>
&lt;li>200: å“åº”æˆåŠŸ&lt;/li>
&lt;li>404: æœªæ‰¾åˆ°èµ„æº&lt;/li>
&lt;li>409: ç”¨æˆ·æ²¡æœ‰ç›¸åº”æƒé™&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-js">import axios from &amp;quot;axios&amp;quot;;
// åˆ›å»º axios å®žä¾‹
const request = axios.create({
baseURL: &amp;quot;https://api.example.com&amp;quot;,
timeout: 2000 // è¯·æ±‚è¶…æ—¶æ—¶é—´
});
// request æ‹¦æˆªå™¨
request.interceptors.request.use(
config =&amp;gt; {
// è®¾ç½® tokenï¼Œæˆ–è€…å…¶ä»–è®¾ç½®
config.headers[&amp;quot;token&amp;quot;] = 'token_123';
return config;
},
err =&amp;gt; {
return Promise.reject(err)
},
);
// response æ‹¦æˆªå™¨
request.interceptors.response.use(
resp =&amp;gt; resp.data,
error =&amp;gt; {
if (error.response) {
const data = error.response.data;
let msg = data.desc || data.exception || '';
switch (error.response.status) {
case 401:
// æç¤ºï¼šç™»å½•è¿‡æœŸï¼Œè·³è½¬ç™»å½•é¡µé¢é‡æ–°ç™»å½•
break;
case 403:
// æç¤ºï¼šæƒé™ä¸è¶³
break;
case 404:
// æç¤ºï¼šèµ„æºä¸å­˜åœ¨
break;
default:
// æç¤ºï¼šè¯·æ±‚å¤±è´¥
break;
}
}
return Promise.reject(error);
}
);
&lt;/code>&lt;/pre>
&lt;h3 id="å°è£…å„ç±»åž‹è¯·æ±‚">å°è£…å„ç±»åž‹è¯·æ±‚&lt;/h3>
&lt;p>è¿™ä¸€æ­¥å°è£…ä¸»è¦æ˜¯ä¸ºäº†ç»Ÿä¸€ axios ä¸­ä¸åŒè¯·æ±‚ç±»åž‹çš„å‚æ•°è¦æ±‚ã€‚&lt;/p>
&lt;p>ä»¥ POST å’Œ GET ä¸ºä¾‹ï¼Œå°è£…ä¹‹å‰&lt;/p>
&lt;pre>&lt;code class="language-js">const payload = { ID: 12345 }
// get è¯·æ±‚ï¼Œparams å±žæ€§å€¼æ˜¯æºå¸¦çš„å‚æ•°
axios.get('/user', {
params: payload
})
// post è¯·æ±‚
axios.post('/user', payload)
&lt;/code>&lt;/pre>
&lt;p>å°è£…ä¹‹åŽï¼š&lt;/p>
&lt;pre>&lt;code class="language-js">const payload = { ID: 12345 }
GET('/user', payload)
POST('/user', payload)
&lt;/code>&lt;/pre>
&lt;p>å°è£…ä¹‹åŽï¼Œæ¯ç§ç±»åž‹çš„è¯·æ±‚æ–¹æ³•éƒ½æŽ¥å—ä¸¤ä¸ªå‚æ•°ï¼šurl å’Œéœ€è¦ä¼ é€’åˆ°æœåŠ¡ç«¯çš„æ•°æ® payloadã€‚&lt;/p>
&lt;p>è¿™é‡Œæˆ‘å°è£…äº† &lt;code>GET&lt;/code> &lt;code>POST&lt;/code> &lt;code>PUT&lt;/code> &lt;code>DELETE&lt;/code> å››ç§æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº” &lt;code>get&lt;/code> &lt;code>post&lt;/code> &lt;code>put&lt;/code> &lt;code>delete&lt;/code> ç±»åž‹çš„è¯·æ±‚ï¼š&lt;/p>
&lt;pre>&lt;code class="language-js">export function GET (url, payload) {
return request.get(url, {
params: payload
});
}
export function POST (url, payload) {
return request.post(url, payload);
}
export function PUT (url, payload) {
return request.put(url, payload);
}
export function DELETE (url, payload) {
return request.delete(url, {
data: payload
});
}
&lt;/code>&lt;/pre>
&lt;p>ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p>
&lt;pre>&lt;code class="language-js">// ç¤ºä¾‹ï¼š
import { GET, POST, PUT, DELETE } from '@/utils/request.js'
const payload = { username: 'admin', password: '123456' }
POST('/login', payload)
.then(resp =&amp;gt; {
// è¯·æ±‚æˆåŠŸ
})
.catch(err =&amp;gt; {
// è¯·æ±‚å¤±è´¥
})
.finally {
// æˆåŠŸ/å¤±è´¥éƒ½ä¼šæ‰§è¡Œè¿™é‡Œä»£ç 
}
&lt;/code>&lt;/pre>
&lt;h2 id="å…¶ä»–">å…¶ä»–&lt;/h2>
&lt;h3 id="post-è¯·æ±‚æ•°æ®æ ¼å¼">post è¯·æ±‚æ•°æ®æ ¼å¼&lt;/h3>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œaxios ä¸­ post è¯·æ±‚çš„ &lt;code>Content-Type&lt;/code> å­—æ®µå¯¹åº”çš„å€¼æ˜¯ &lt;code>application/json&lt;/code> ï¼Œæ­¤æ—¶æ˜¯ä»¥ json æ ¼å¼å‘æœåŠ¡ç«¯å‘é€æ•°æ®ã€‚&lt;/p>
&lt;p>å¦‚æžœæƒ³è¦ä»¥ &lt;code>FormData&lt;/code> å½¢å¼å‘é€æ•°æ®ï¼Œä½ å¯ä»¥è¿™æ ·è§£å†³&lt;/p>
&lt;pre>&lt;code class="language-js">import axios from &amp;quot;axios&amp;quot;;
import qs from 'qs';
const data = { 'bar': 123 };
const options = {
url,
method: 'POST',
data: qs.stringify(data),
headers: { 'content-type': 'application/x-www-form-urlencoded' },
};
axios(options);
&lt;/code>&lt;/pre>
&lt;p>é‚£ä¹ˆå‰é¢å¯¹ POST æ–¹æ³•çš„å°è£…ä¹Ÿè¦è¿›è¡Œä¿®æ”¹ï¼š&lt;/p>
&lt;pre>&lt;code class="language-js">import qs from 'qs';
export function POST (url, payload) {
const options = {
url,
method: 'POST',
data: qs.stringify(data),
headers: { 'content-type': 'application/x-www-form-urlencoded' },
};
return request(options);
}
&lt;/code>&lt;/pre>
&lt;!--
ç–‘é—®ï¼š
å…¨å±€è®¾ç½®æ˜¯å¦æœ‰æ•ˆ
// è®¾ç½® post è¯·æ±‚çš„ Content-Type
request.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
-->
&lt;h3 id="æŒ‚è½½åˆ°-vue-åŽŸåž‹ä¸Š">æŒ‚è½½åˆ° vue åŽŸåž‹ä¸Š&lt;/h3>
&lt;pre>&lt;code class="language-js">import { GET, POST, PUT, DELETE } from '@/utils/request.js'
Vue.prototype.$http = {
get: GET,
post: POST,
put: PUT,
delete: DELETE
}
&lt;/code>&lt;/pre>
&lt;p>æŒ‚è½½åˆ°åŽŸåž‹ä¸Šä¹‹åŽï¼Œå°±å¯ä»¥åœ¨ä»»æ„çš„ vue ç»„ä»¶å†…é€šè¿‡ vue å®žä¾‹è°ƒç”¨è¯·æ±‚ï¼š&lt;/p>
&lt;pre>&lt;code class="language-js">this.$http.get('/user', { id: 123 })
&lt;/code>&lt;/pre>
&lt;h2 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç &lt;/h2>
&lt;details>
&lt;summary>
å®Œæ•´çš„ request.js ä»£ç åœ¨æ­¤ï¼Œè¯·ç‚¹å‡»å±•å¼€å®Œæ•´ä»£ç 
&lt;/summary>
&lt;pre>&lt;code class="language-js">// request.js
import axios from &amp;quot;axios&amp;quot;;
// åˆ›å»º axios å®žä¾‹
const request = axios.create({
baseURL: &amp;quot;https://api.example.com&amp;quot;,
timeout: 2000, // è¯·æ±‚è¶…æ—¶æ—¶é—´
});
// request æ‹¦æˆªå™¨
request.interceptors.request.use(
config =&amp;gt; {
// è®¾ç½® tokenï¼Œæˆ–è€…å…¶ä»–è®¾ç½®
config.headers[&amp;quot;token&amp;quot;] = 'token_123';
return config;
},
err =&amp;gt; {
return Promise.reject(err)
},
);
// response æ‹¦æˆªå™¨
request.interceptors.response.use(
resp =&amp;gt; resp.data,
error =&amp;gt; {
if (error.response) {
const data = error.response.data;
let msg = data.desc || data.exception || '';
switch (error.response.status) {
case 401:
// æç¤ºï¼šç™»å½•è¿‡æœŸï¼Œè·³è½¬ç™»å½•é¡µé¢é‡æ–°ç™»å½•
break;
case 403:
// æç¤ºï¼šæƒé™ä¸è¶³
break;
case 404:
// æç¤ºï¼šèµ„æºä¸å­˜åœ¨
break;
default:
// æç¤ºï¼šè¯·æ±‚å¤±è´¥
break;
}
}
return Promise.reject(error);
}
);
export function GET (url, payload) {
return request.get(url, {
params: payload
});
}
export function POST (url, payload) {
return request.post(url, payload);
}
export function PUT (url, payload) {
return request.put(url, payload);
}
export function PATCH (url, payload) {
return request.patch(url, payload);
}
export function DELETE (url, payload) {
return request.delete(url, {
params: payload
});
}
&lt;/code>&lt;/pre>
&lt;/details>
&lt;hr>
&lt;p>æœ¬æ–‡å®Œï¼Œæ„Ÿè°¢é˜…è¯»ã€‚ðŸ˜œ&lt;/p></description></item></channel></rss>